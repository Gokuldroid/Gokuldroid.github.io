{"componentChunkName":"component---src-components-module-blog-post-index-jsx","path":"/posts/java-perf-matters-1/","result":{"data":{"post":{"html":"<p>Doing microbenchmark is really hard.benchmarking code in microseconds, nanoseconds requires a lot of things to consider.<strong>Benchmark results may vary for each computer</strong>.Sometimes it differs in the same machine if you do it multiple times as the machine <strong>will be at same state ever</strong>.To keep the external noise minimum,it is advised to close all the running application so that it doesn't wait for another process to release resources.JIT compiler is playing major role optimising java code on the fly.It does some really great work but in our case, it is also a great factor to consider.For example, when you execute a function multiple times JIT optimises the code. It removes dead code (Empty methods etc, optimising bytecode, inlining functions etc). So we have to fake the JIT compiler so that it doesn't optimise our benchmarking code.In this tutorial, I am going to use JMH Gradle plugin to make tests.</p>\n<blockquote>\n<p>Source code of this tutorial can be found at : <a href=\"https://github.com/Gokuldroid/PrefMatters\">PrefMatters</a></p>\n</blockquote>\n<h4 id=\"how-to-run-\" style=\"position:relative;\"><a href=\"#how-to-run-\" aria-label=\"how to run  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to run :</h4>\n<p>Check out code\n<strong>cd dir</strong> and run cmd <strong>gradlew.bat clean &#x26;&#x26; gradlew.bat jmh</strong></p>\n<p>We will start with well known collection arraylist.</p>\n<p>Let's prepare a state class that we will use accross each test.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Constants</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> NO_OF_VALS <span class=\"token operator\">=</span> <span class=\"token number\">500000</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> vals <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>NO_OF_VALS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Constants</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>vals<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token class-name\">Random</span> random <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> NO_OF_VALS<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token punctuation\">{</span>\n\t\t\t\tvals<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> random<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span>MAX_VALUE <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<br/>\n### **Iterating over arraylist :**\n<p>1.using foreach</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">forEachList</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span> constants<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Blackhole</span> blackhole<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> vals <span class=\"token operator\">=</span> constants<span class=\"token punctuation\">.</span>vals<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span> val <span class=\"token operator\">:</span> vals<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tblackhole<span class=\"token punctuation\">.</span><span class=\"token function\">consume</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>blockhole is to consume the val. If we left the loop empty JIT will optimise the loop. That we do't need in our case</p>\n</blockquote>\n<p>2.using indexed loop</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">forEachIndexed</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span> constants<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Blackhole</span> blackhole<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> vals <span class=\"token operator\">=</span> constants<span class=\"token punctuation\">.</span>vals<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> vals<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tblackhole<span class=\"token punctuation\">.</span><span class=\"token function\">consume</span><span class=\"token punctuation\">(</span>vals<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>3.using fast indexed loop(intellij IDE says so , we will find out that soon)</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">forEachFastIndexed</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span> constants<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Blackhole</span> blackhole<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> vals <span class=\"token operator\">=</span> constants<span class=\"token punctuation\">.</span>vals<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> size <span class=\"token operator\">=</span> vals<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> size<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tblackhole<span class=\"token punctuation\">.</span><span class=\"token function\">consume</span><span class=\"token punctuation\">(</span>vals<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>4.using iterator</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span> constants<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Blackhole</span> blackhole<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> itr <span class=\"token operator\">=</span> constants<span class=\"token punctuation\">.</span>vals<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>itr<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tblackhole<span class=\"token punctuation\">.</span><span class=\"token function\">consume</span><span class=\"token punctuation\">(</span>itr<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>5.using list iterator</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">listIterator</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span> constants<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Blackhole</span> blackhole<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">ListIterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> itr <span class=\"token operator\">=</span> constants<span class=\"token punctuation\">.</span>vals<span class=\"token punctuation\">.</span><span class=\"token function\">listIterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>itr<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tblackhole<span class=\"token punctuation\">.</span><span class=\"token function\">consume</span><span class=\"token punctuation\">(</span>itr<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Benchmark results:</p>\n<p>Throughput method (Higher is better):</p>\n<table>\n<thead>\n<tr>\n<th>Benchmark</th>\n<th align=\"center\">Mode</th>\n<th align=\"right\">Score</th>\n<th align=\"right\">Error</th>\n<th align=\"right\">Unit</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>forEachFastIndexed</td>\n<td align=\"center\">thrpt</td>\n<td align=\"right\">372.821</td>\n<td align=\"right\">± 6.424</td>\n<td align=\"right\">ops/s</td>\n</tr>\n<tr>\n<td>forEachIndexed</td>\n<td align=\"center\">thrpt</td>\n<td align=\"right\">409.919</td>\n<td align=\"right\">± 14.473</td>\n<td align=\"right\">ops/s</td>\n</tr>\n<tr>\n<td>forEachList</td>\n<td align=\"center\">thrpt</td>\n<td align=\"right\">302.609</td>\n<td align=\"right\">± 6.424</td>\n<td align=\"right\">ops/s</td>\n</tr>\n<tr>\n<td>iterator</td>\n<td align=\"center\">thrpt</td>\n<td align=\"right\">343.567</td>\n<td align=\"right\">± 13.681</td>\n<td align=\"right\">ops/s</td>\n</tr>\n<tr>\n<td>listIterator</td>\n<td align=\"center\">thrpt</td>\n<td align=\"right\">338.176</td>\n<td align=\"right\">± 12.085</td>\n<td align=\"right\">ops/s</td>\n</tr>\n</tbody>\n</table>\n<br/>\nSingleshot method (Lower is better): \n<p>For 5L entries</p>\n<table>\n<thead>\n<tr>\n<th>Benchmark</th>\n<th align=\"center\">Mode</th>\n<th align=\"right\">Score</th>\n<th align=\"right\">Error</th>\n<th align=\"right\">Unit</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>forEachFastIndexed</td>\n<td align=\"center\">ss</td>\n<td align=\"right\">3.907</td>\n<td align=\"right\">± 0.692</td>\n<td align=\"right\">ms/op</td>\n</tr>\n<tr>\n<td>forEachIndexed</td>\n<td align=\"center\">ss</td>\n<td align=\"right\">5.299</td>\n<td align=\"right\">± 0.890</td>\n<td align=\"right\">ms/op</td>\n</tr>\n<tr>\n<td>forEachList</td>\n<td align=\"center\">ss</td>\n<td align=\"right\">5.501</td>\n<td align=\"right\">± 1.898</td>\n<td align=\"right\">ms/op</td>\n</tr>\n<tr>\n<td>iterator</td>\n<td align=\"center\">ss</td>\n<td align=\"right\">5.053</td>\n<td align=\"right\">± 1.113</td>\n<td align=\"right\">ms/op</td>\n</tr>\n<tr>\n<td>listIterator</td>\n<td align=\"center\">ss</td>\n<td align=\"right\">6.767</td>\n<td align=\"right\">± 1.569</td>\n<td align=\"right\">ms/op</td>\n</tr>\n</tbody>\n</table>\n<p>For 50 entries</p>\n<table>\n<thead>\n<tr>\n<th>Benchmark</th>\n<th align=\"center\">Mode</th>\n<th align=\"right\">Score</th>\n<th align=\"right\">Error</th>\n<th align=\"right\">Unit</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>forEachFastIndexed</td>\n<td align=\"center\">ss</td>\n<td align=\"right\">0.013</td>\n<td align=\"right\">± 0.002</td>\n<td align=\"right\">ms/op</td>\n</tr>\n<tr>\n<td>forEachIndexed</td>\n<td align=\"center\">ss</td>\n<td align=\"right\">0.021</td>\n<td align=\"right\">± 0.020</td>\n<td align=\"right\">ms/op</td>\n</tr>\n<tr>\n<td>forEachList</td>\n<td align=\"center\">ss</td>\n<td align=\"right\">0.025</td>\n<td align=\"right\">± 0.002</td>\n<td align=\"right\">ms/op</td>\n</tr>\n<tr>\n<td>iterator</td>\n<td align=\"center\">ss</td>\n<td align=\"right\">0.024</td>\n<td align=\"right\">± 0.003</td>\n<td align=\"right\">ms/op</td>\n</tr>\n<tr>\n<td>listIterator</td>\n<td align=\"center\">ss</td>\n<td align=\"right\">0.029</td>\n<td align=\"right\">± 0.025</td>\n<td align=\"right\">ms/op</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Conclusion :</strong></p>\n<p>forEachList , iterator , listIterator yields same performance most of the time. forEach complies to iterator pattern when we compile and the working of those list internally same. indexed for loop yields better performance than iterators method.Fast index method is really means something in single invoke.Iterator implementation additionally checks for modification,makes method calls internally.In our test we used 5L objects. For smaller size result may be different.Play with this size you will get to know better.I will tend to use fast indexed loop method as my IDE does the auto-completion. This is ok for running app in PC. In android these benchmarks is really important. because we need to squeeze every cycle of CPU.</p>\n<h3 id=\"adding-elements-to-arraylist-\" style=\"position:relative;\"><a href=\"#adding-elements-to-arraylist-\" aria-label=\"adding elements to arraylist  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>Adding elements to arraylist :</strong></h3>\n<p>1.Prepare size and add</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">preparedAdd</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span> constants<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Blackhole</span> blackhole<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> vals <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span><span class=\"token punctuation\">.</span>NO_OF_VALS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token class-name\">Constants</span><span class=\"token punctuation\">.</span>NO_OF_VALS<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tvals<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\tblackhole<span class=\"token punctuation\">.</span><span class=\"token function\">consume</span><span class=\"token punctuation\">(</span>vals<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>2.Just add</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span> constants<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Blackhole</span> blackhole<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> vals <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token class-name\">Constants</span><span class=\"token punctuation\">.</span>NO_OF_VALS<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\tvals<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\tblackhole<span class=\"token punctuation\">.</span><span class=\"token function\">consume</span><span class=\"token punctuation\">(</span>vals<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Benchmark results:</p>\n<p>Throughput method (Higher is better):</p>\n<table>\n<thead>\n<tr>\n<th>Benchmark</th>\n<th align=\"center\">Mode</th>\n<th align=\"right\">Score</th>\n<th align=\"right\">Error</th>\n<th align=\"right\">Unit</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>add</td>\n<td align=\"center\">thrpt</td>\n<td align=\"right\">180.190</td>\n<td align=\"right\">± 15.306</td>\n<td align=\"right\">ops/s</td>\n</tr>\n<tr>\n<td>preparedAdd</td>\n<td align=\"center\">thrpt</td>\n<td align=\"right\">257.963</td>\n<td align=\"right\">± 26.253</td>\n<td align=\"right\">ops/s</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Conclusion :</strong></p>\n<p>It is clear that preparing size before adding yields better performance while adding. Initally arraylist will have default capacity of 10. When the arraylist grows internal array is grown to accommodate the data.If we know the size before inserting data it is better to create array with size make <strong>ensureCapacity(size)</strong> to pre-allocate size so that we can avoid unnecessary operations like creating array,copying old array to new array etc.</p>","excerpt":"Doing microbenchmark is really hard.benchmarking code in microseconds, nanoseconds requires a lot of things to consider.Benchmark results…","tableOfContents":"<ul>\n<li>\n<ul>\n<li><a href=\"#how-to-run-\">How to run :</a></li>\n</ul>\n</li>\n<li><a href=\"#adding-elements-to-arraylist-\"><strong>Adding elements to arraylist :</strong></a></li>\n</ul>","frontmatter":{"title":"Java : Perf matters - 1","path":"java-perf-matters-1","tags":["Java","Programming"],"parentPath":null}},"parentPost":null,"siblingPosts":{"edges":[]},"previousPost":{"frontmatter":{"title":"Android loggers analyzed"}},"nextPost":null},"pageContext":{"parentPath":null,"pageId":"c32129fc-f6a3-5f0c-8e0a-09e11240f19f","previousPagePath":"/posts/android-loggers-analyzed/","previousItem":{"node":{"id":"f98a4621-85ff-59e4-bebe-9c519345b710","frontmatter":{"title":"Android loggers analyzed","path":"android-loggers-analyzed","parentPath":null,"date":"2019-04-20T10:57:14.369Z","categories":["android"]}},"context":{"parentPath":null}},"previousPageId":"f98a4621-85ff-59e4-bebe-9c519345b710","nextPagePath":"","nextPageId":""}},"staticQueryHashes":["3128451518"]}